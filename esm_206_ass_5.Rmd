---
title: "The Majesty of the Giant Salamander: A Memoir"
author: "Alex Milward and Pat Byrne"
date: "11/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r, include=FALSE}
#Attach packages, not sure yet which we need
library(tidyverse)
library(janitor)
library(kableExtra)
library(here)
library(effsize)
library(ggbeeswarm)
library(lubridate)
library(ggridges)

```

```{r}
# Read in data
vertebrates <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()
```

 

### Introduction

### Data and Methods

### Results

#### Results A: Visually compare annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek

```{r}

#Find total annual counts for two different sections of Mack Creek

vertebrates_section <- vertebrates %>% 
  select(year, section) %>% 
  group_by(year, section) %>% 
  count(section)


```

```{r}
# Plot changes in counts over time for both sections

ggplot(data = vertebrates_section, aes(x = year, y = n)) +
  geom_line(aes(color = section), show.legend = FALSE) +
  geom_point(aes(color = section), show.legend = FALSE) +
  facet_wrap(~section) +
  theme_bw() +
  scale_x_continuous(expand = c(0.1,0)) +
  scale_y_continuous(expand = c(0.1,0)) +
  labs(x = "year",
       y = "salamander count",
       title = "Change in salamander counts in old growth and clear cut forests",
       subtitle = "1987 - 2017",
       caption = "Figure 1: Changes in salamander abundance in old growth and clear cut forests from 1987 to 2017") 

ggplot(data = vertebrates_section, aes(x = year, y = n)) +
  geom_col(aes(fill = section), color = "black", show.legend = FALSE) +
  facet_wrap(~section) +
  theme_bw() +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Year",
       y = "No. Salamanders Observed",
       title = "Change in salamander counts in old growth and clear cut forests",
       subtitle = "1987 - 2017",
       caption = "Figure 1: Changes in salamander abundance in old growth and clear cut forests from 1987 to 2017") 
```

#### Results B: Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

```{r}
# Group by OG and CC sections, and keep only data for pool, cascades, and side channels in 2017

vertebrates_count <- vertebrates %>%
  select(year, section, unittype) %>% 
  filter(year == "2017", unittype %in% c("C", "P", "SC")) %>% 
  count(unittype, section) %>% 
  pivot_wider(names_from = unittype, values_from = n) %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

vertebrates_count %>%
  kable(col.names = c("Forest Section", "Cascade", "Pool", "Side Channel")) %>% 
  kable_styling()
  
```

#### Results C: Significance of the effect of forest condition on channel location.

```{r}
# Same as before, now for chi-sqd test
vertebrates_chi <- vertebrates %>%
  select(year, section, unittype) %>% 
  filter(year == "2017", unittype %in% c("C", "P", "SC")) %>% 
  count(unittype, section) %>% 
  pivot_wider(names_from = unittype, values_from = n) %>% 
  select(-section)

vert_chi_test <- chisq.test(vertebrates_chi)
vert_chi_test
```


#### Results D: Comparison of weights in 2017 between sections.

```{r}
# Running a t test and a Mann-Whitney U test for weights between the two sections
vertebrates_weights <- vertebrates %>% 
  filter(year == "2017", unittype %in% c("C", "P", "SC")) %>% 
  select(weight, section, unittype) 

OG_weights <- vertebrates_weights %>% 
  filter(section == 'OG') %>% 
  select(weight)
OG_wts_vec <- OG_weights$weight

CC_weights <- vertebrates_weights %>% 
  filter(section == 'CC') %>% 
  select(weight)
CC_wts_vec <- CC_weights$weight

weights_man_w <- wilcox.test(OG_wts_vec, CC_wts_vec)
weights_t <- t.test(OG_wts_vec, CC_wts_vec)
weights_d <- cohen.d(OG_wts_vec, CC_wts_vec)


# ggplot(data = OG_weights, aes(x = weight)) +
#   geom_histogram()
# ggplot(data = CC_weights, aes(x = weight)) +
#   geom_histogram()

```


#### Results E: Comparison of the weights between channel locations.

```{r}
# Wrangling the data for results E
C_weights <- vertebrates_weights %>% 
  filter(unittype == 'C') %>% 
  select(weight)
c_wts_vec <- C_weights$weight

P_weights <- vertebrates_weights %>% 
  filter(unittype == 'P') %>% 
  select(weight)
p_wts_vec <- P_weights$weight

SC_weights <- vertebrates_weights %>% 
  filter(unittype == 'SC') %>% 
  select(weight)
sc_wts_vec <- SC_weights$weight

weights <- vertebrates_weights %>% 
  select(-section) %>% 
  group_by(unittype)

weights_summary <- weights %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE),
            sample_size = n(),
            se_weight = sd((weight) / sqrt(n()), (na.rm = TRUE)),
            var_weight = var(weight, na.rm = TRUE))

```

```{r}
# Visually comparing weights using a beeswarm plot (@ALEX: I think beeswarm with mean, maybe median (help with third part of E) and standard error is the way to go here cuz it's easy and gets the job done - ya boi is trying to work on this whole thing as little as possible lol)

ggplot() +
  geom_jitter(data = weights,
                aes(x = unittype, y = weight),
                size = 1,
              color = "gray70") +
  scale_x_discrete(labels = c("Cascade", "Pools", "Side Channel")) +
  geom_point(data = weights_summary, aes(x = unittype, y = mean_weight)) +
  geom_errorbar(data = weights_summary,
                aes(x = unittype,
                    ymin = mean_weight - sd_weight,
                    ymax = mean_weight + sd_weight),
                width = 0.2) +
  labs(x = "Unit Type",
       y = "Weight (g)",
       title = "Pacific Giant Salamander weights in cascades, pools, and side channels")
  
  ggplot(data = weights, aes(x = weight, y = unittype)) +
  geom_density_ridges(aes(fill = unittype, alpha = 0.5),
                      show.legend = FALSE) +
    scale_x_continuous(expand = c(0,0)) +
    scale_y_discrete(labels = c("Side Channel", "Pool", "Cascade")) +
    geom_point(data = weights_summary, aes(x = mean_weight, y = unittype)) +
    theme_minimal() +
    labs(x = "Weight (g)",
       y = "Unit Type",
       title = "Pacific Giant Salamander weights in cascades, pools, and side channels")

```

```{r}
#One-way ANOVA test to compare means across cascade, pool, and side channel salamanders

#H0 - Means across all three are the same
#Ha - At least two means are different

weight_anova <- aov(weight ~ unittype, data = weights)
summary(weight_anova)

post_hoc <- TukeyHSD(weight_anova)
post_hoc

# p-value << 0.01 so we reject the null hypothesis.
# Post hoc Tukey HSD test reveals that Side-Channels and Cascade mean size are not signficantly different, however, pool means differ significantly from cascade and side channel means.
# I DONT KNOW WHY WE ARE COMPARING MEANS IF THE DATA IS NOT NORMALLY DISTRIBUTED.  Seems like medians would be better, however, results E asks us to compare means.
```

We are concerned with comparing means across unit types because the data is not normally distributed.  The data is positively skewed, and so medians would be better for statistical analysis.  For this we would run a Kruskal-Wallis non-parametric test.
