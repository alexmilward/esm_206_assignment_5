---
title: "The Majesty of the Giant Salamander: A Memoir"
author: "Alex Milward and Pat Byrne"
date: "11/24/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r, include=FALSE}
#Attach packages, not sure yet which we need
library(tidyverse)
library(janitor)
library(kableExtra)
library(here)
library(effsize)
library(ggbeeswarm)
library(lubridate)

```

```{r}
# Read in data
vertebrates <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names()
```

 

### Introduction

### Data and Methods

### Results

#### Results A: Visually compare annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek

```{r}

#Find total annual counts for two different sections of Mack Creek

vertebrates_section <- vertebrates %>% 
  select(year, section) %>% 
  group_by(year, section) %>% 
  count(section)


```

```{r}
# Plot changes in counts over time for both sections

ggplot(data = vertebrates_section, aes(x = year, y = n)) +
  geom_line(aes(color = section), show.legend = FALSE) +
  geom_point(aes(color = section), show.legend = FALSE) +
  facet_wrap(~section) +
  theme_bw() +
  scale_x_continuous(expand = c(0.1,0)) +
  scale_y_continuous(expand = c(0.1,0)) +
  labs(x = "year",
       y = "salamander count",
       title = "Change in salamander counts in old growth and clear cut forests",
       subtitle = "1987 - 2017",
       caption = "Figure 1: Changes in salamander abundance in old growth and clear cut forests from 1987 to 2017") 

ggplot(data = vertebrates_section, aes(x = year, y = n)) +
  geom_col(aes(fill = section), color = "black", show.legend = FALSE) +
  facet_wrap(~section) +
  theme_bw() +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Year",
       y = "No. Salamanders Observed",
       title = "Change in salamander counts in old growth and clear cut forests",
       subtitle = "1987 - 2017",
       caption = "Figure 1: Changes in salamander abundance in old growth and clear cut forests from 1987 to 2017") 
```

#### Results B: Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

```{r}
# Group by OG and CC sections, and keep only data for pool, cascades, and side channels in 2017

vertebrates_count <- vertebrates %>%
  select(year, section, unittype) %>% 
  filter(year == "2017", unittype %in% c("C", "P", "SC")) %>% 
  count(unittype, section) %>% 
  pivot_wider(names_from = unittype, values_from = n) %>% 
  adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front")

vertebrates_count %>%
  kable(col.names = c("Forest Section", "Cascade", "Pool", "Side Channel")) %>% 
  kable_styling()
  
```

#### Results C: Significance of the effect of forest condition on channel location.

```{r}
# Same as before, now for chi-sqd test
vertebrates_chi <- vertebrates %>%
  select(year, section, unittype) %>% 
  filter(year == "2017", unittype %in% c("C", "P", "SC")) %>% 
  count(unittype, section) %>% 
  pivot_wider(names_from = unittype, values_from = n) %>% 
  select(-section)

vert_chi_test <- chisq.test(vertebrates_chi)
vert_chi_test
```


#### Results D: Comparison of weights in 2017 between sections.

```{r}
# Running a t test for weights between the two sections
vertebrates_weights <- vertebrates %>% 
  filter(year == "2017") %>% 
  select(weight, section) 

OG_weights <- vertebrates_weights %>% 
  filter(section == 'OG') %>% 
  select(weight)

CC_weights <- vertebrates_weights %>% 
  filter(section == 'CC') %>% 
  select(weight)

OG_test <- OG_weights$weight
CC_test <- CC_weights$weight

weights_ttest <- t.test(OG_test, CC_test)
weights_d <- cohen.d(OG_test, CC_test)

```


#### Results E: Comparison of the weights between channel locations.

